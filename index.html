<!DOCTYPE html>
<html lang="en-us">
    <head>
        <meta charset="UTF-8">
        <title>Editor</title>
        <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.11.0/umd/popper.min.js" integrity="sha384-b/U6ypiBEHpOf/4+1nzFpr53nxSS+GLCkfwBdFNTxtclqqenISfwAzpKaMNFNmj4" crossorigin="anonymous"></script>
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/css/bootstrap.min.css" integrity="sha384-/Y6pD6FV/Vv2HJnA6t+vslU6fwYXjCFtcEpHbNJ0lyAFsXTsjBbfaDjzALeQsN6M" crossorigin="anonymous">
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/js/bootstrap.min.js" integrity="sha384-h0AbiXch4ZDo7tp9hKZ4TsHbi047NrKGLO3SEJAg45jXxnGIfYzk4Si90RDIqNm1" crossorigin="anonymous"></script>
        <script src="https://www.gstatic.com/firebasejs/5.1.0/firebase.js"></script>
        <!-- <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/vis/4.21.0/vis.min.css"> -->
        <link rel="stylesheet" type="text/css" href="css/vis.css">
        <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/vis/4.21.0/vis.min.js"></script>
        <!-- <script type="text/javascript" src="js/vis.js"></script> -->

        <link rel="stylesheet" type="text/css" href="css/net_editor.css">
    </head>

    <style type="text/css">
        #info-form {
            position: absolute;
            width: 20%;
            top: 35%;
            left: 40%;
        }
        .submit_page1 {
            margin-top: 20px;
            margin-bottom: 20px;
            margin-right: 20px;
        }
        #section-group .radio {
            margin-left: 5px;
        }
        .instr {
            margin: auto;
            margin-bottom: 20px;
            width: 600px;
            margin-top: 10vh;
        }

        #add_friends {
            margin-right: 20px;
        }

        #friends_list {
            margin-top: auto;
        }

        #remove_friend {
            margin-top: 20px;
            margin-bottom: 20px;
            margin-right: 20px;
        }

        #info-form1 {
            width: 20%;
            margin: auto;


        }


    </style>

    <script type="text/javascript">

        //<!-- page 1 scripts -->

        var userId = null, sectionId = null;
        function signin() {
            $('#user-id').removeClass('is-invalid');
            userId = $('#user-id').val();
            sectionId = 1;
            if (!userId.startsWith('subj') || isNaN(userId.substring(4))) {  // error checking
                $('#user-id').addClass('is-invalid');
                return;
            }
            //$('#instr-text').text(instrText[parseInt(userId.substring(4)) % 2]);
            $('#page1').hide();
            $('#page2').show();
        }

        //<!-- page2 scripts -->

        var friends = [];

        var friend_count = 1;

        $(function() {
          $('#add_friends').click(function() {
              console.log("add")
              $('#friends_list').append("<div id='user-id-group" + friend_count + "' class='form-group'> <label id='user-id-text' class='control-label' for='user-id'>Friend " + (friend_count + 1) + " (first name, last initial)</label> <input id='user-id-input" + friend_count + "' type='text' class='form-control input-md' required> </div>");
              friend_count+=1;
              console.log(friend_count);

          });
        });

        function eval_input() {
            friends = []
            console.log("eval called")
            for (var q = 0; q < friend_count; q++) {
                var friend_input = $('#user-id-input' + q).val();
                console.log(friends)
                console.log(friend_input in friends)

                if (/[^a-zA-Z ]/.test(friend_input) || friends.indexOf(friend_input) != -1) {
                    console.log("bad input")
                    $('#user-id-input' + q).addClass('is-invalid');
                    friends = [];
                    return;
                }

                friends.push(friend_input);
            }

            console.log(friends);
            console.log(userId);
            console.log(sectionId);

            //sessionStorage.clear();


            $("#page2").hide();
            $("#page3").show();
        }

        $(function(){
            $("#submit-page3").click(function() {
                sessionStorage.setItem('friends', friends);
                console.log("FRIENDS STORED??");
                console.log(friends)
                sessionStorage.setItem('userId', userId);
                sessionStorage.setItem('sectionId', sectionId);
                window.location.href = 'editor.html';
            });
        });

        $(function() {
            $("#back").click(function(){
                $("#page3").hide();
                $("#page2").show();
            });
        });

        $(function(){
            $("#remove_friend").click(function() {
                if (friend_count>1) {
                    $('#user-id-group' + (friend_count -1) ).remove();
                    friend_count = friend_count - 1;
                    console.log("remove: " + friend_count)
                }
            });
        });

    </script>

    <body>

        <div id="page1"
            <div id="info1">
                <div id="info-form" class="survey" data-toggle="validator" role="form">
                    <form action="javascript:signin();" class="form-horizontal">
                        <div id="user-id-group" class="form-group">
                            <label id="user-id-text" class="control-label" for="user-id">ID</label>
                            <input id="user-id" type="text" class="form-control input-md" required>
                        </div>
                        <div id="section-group" class="form-group">
                            <!--
                            <label id="user-id-text" class="control-label">Section</label>

                            <div class="row">
                                <div class="radio col-auto">
                                    <input name="section" type="radio" value="1" required> 1
                                </div>
                                <div class="radio col">
                                    <input name="section" type="radio" value="2"> 2
                                </div>
                            </div>
                            --->
                        </div>
                        <button id="submit-page1" type="submit" class="btn btn-primary submit_page1">Submit</button>
                    </form>
                </div>
            </div>
        </div>

        <div id="page2">
            <div id="instr1" class = "instr">
                <p id="instr-text"> Consider all the people with whom you like to spend your free time. <b> Since you arrived at Columbia, who are the people whom you have been with most often for informal social activities, such as going out to lunch, dinner, drinks, exercising or studying together, hanging out in each other’s rooms and/or homes, and so on? </b> </p>
                <p id="instr-text"> Once you’ve entered a name, click the green <b>‘Add friend’ </b> button to enter another. There is no limit to the number of people you can name, so please list all the people with whom you socialize regularly. Order does not matter. </p>
                <p id="instr-text"> Once you’re finished adding names, click the blue <b> ‘Submit’ </b> button. </p>
                <p id="instr-text" style="color:red"> <b> Please only enter letters and make sure each entry is unique. </b> </p>

            </div>

            <div id="info2">
                <div id="info-form1" class="survey" data-toggle="validator" role="form">
                    <form action = "javascript:eval_input()" class="form-horizontal">
                        <div id="friends_input">
                            <div id="friends_list">
                                <div id="user-id-group0" class="form-group">
                                    <label id="user-id-text" class="control-label" for="user-id">Friend 1 (first name, last initial)</label>
                                    <input id="user-id-input0" type="text" class="form-control input-md" required>
                                </div>
                            </div>
                        </div>
                        <button id="add_friends" type="button" class="btn btn-success add-btn">Add friend</button>
                        <button id="remove_friend" type="button" class="btn btn-danger"> Remove friend </button>
                        <button id="submit-page2" type="submit" class="btn btn-primary submit_page2">Submit</button>
                    </form>
                </div>
            </div>
        </div>

        <div id="page3">
            <div id="instr2" class="instr">
                <p id="instr-text"> Thank you! On the next page, you will be asked to draw the connections between the friends you named. That is, you will use connections to show who is friends with whom (i.e., who regularly socializes with whom). </p>
                <p id="instr-text"> Press start whenever you are ready for the next task. </p>
                <p id="instr-text"> If you wish to add more friends, press <b>"Back"</b> at this time. </p>

                <button id="submit-page3" type="submit" class = "btn btn-primary submit_page3"> Start </button>
                <button id="back" type="submit" class = "btn btn-danger"> Back (add more friends)</button>

            </div>



        </div>



    </body>

    <script>
        $('#page3').hide();
        $('#page2').hide();
    </script>




</html>
